<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI計算器</title>
    <link rel="stylesheet" href="css/style.css">

    <style>
        form{
            position: relative;
            width: 40%;
            background-color: rgb(94, 197, 197);
            margin: 24px auto;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 10px 10px 5px rgb(75,83,85);
        }

        input{
            margin: 6px 0px;
            font-size: 20px;
            text-align: center;
        }
        label{
            font-size: 20px;
        }
        .panell1{
            background-color: rgb(195,227,255);
            padding: 6px;
            border: 2px dotted pink;
            margin: 6px;
        }
        button{
            width: 80px;
            height: 30px;
            margin-top: 1rem;
            background-color: aqua;
            border: none;
            font-size: 16px;
            border-radius: 6px;
            color: blue;
        }
        button:hover{
            background-color: cadetblue;
            cursor: pointer;
        }
        a{
            position: absolute;
            background-color: brown;
            color: white;
            padding: 12px;
            border-radius: 6px;
            text-decoration: none;
            top: 12px;
            right: 12px;
        }
        a:hover{
            color: red;
        }

        #result{
            font-size: 2rem;
            font-weight:100;
            background-color: aquamarine;
            border-radius: 15%;
        }
        .comment{
            font-size: 1rem;
        }

        #info{
            background-color: gray;
        }

        #record{
            font-size: 32px;
            margin-top: 24px;
        }



    </style>

</head>

<body>
    <div class="main-title">BMI計算器</div>

    <button type="button" id="deleteRecordBtn">刪除</button>

    <div id="record"></div>


    <form action="">
        <br>
        <label for="username">姓名</label>
        <input id="username" idtype="姓名" ytpe="text" placeholder="請輸入姓名">
        <br><br>
        <label for="age">年齡</label>
        <input id="age" name="age" idtype="姓名" type="number" value="18">
        <br><br>
        <label for="height">身高</label>
        <input id="height" name="height" type="number" step="0.1" value="168">
        <br><br>
        <label for="weight">體重</label>
        <input id="weight" name="weight" type="number" step="0.1" value="85">
        <br><br>
        <div class="panell1">
            <input type="radio" name="sex" id="male" checked value="男">男
            <input type="radio" name="sex" id="female"  value="女">女
            <label for="county"居住縣市>居住縣市</label>
            <select name="county" id="county">
                <option value="台北市">台北市</option>
                <option value="新北市">新北市</option>
                <option value="桃園市">桃園市</option>
                <option value="台中市">台中市</option>
                <option value="台南市">台南市</option>
                <option value="高雄市">高雄市</option>
            </select>
        </div>
        <br><br>
        <button type="button" onclick="calc()">計算</button>

        <a href="index.html">首頁</a>
    </form>

    <div id="info">

    </div>

    <div id="result" hidden="true">
        BMI:<span class="bmi">
        </span>

        <p class="comment">
        </p>
    </div>


 
    <script>
        const heightEl=document.querySelector("#height");
        const weightEl=document.querySelector("#weight");
        const usernameEl=document.querySelector("#username");
        const ageEl=document.querySelector("#age");
        const countyEl=document.querySelector("#county");
        const deleteRecordBtnEl= document.querySelector("#deleteRecordBtn");
        
        console.log(deleteRecordBtnEl);

        deleteRecordBtnEl.addEventListener("click",function(){
            localStorage.removeItem("record");

            /*let recordEl=document.querySelector("#record");
            console.log(recordEl);*/

            //刷新頁面
            //window.location.href="";
            document.querySelector("#record").innerHTML="";
            data.total=0;
            data.count=0;

        });
        //console.log(heightEl,weightEl,usernameEl,ageEl,countyEl,heightEl.value,weightEl.value,usernameEl.value,ageEl.value,countyEl.value,);

        let data={
            total:0,
            count:0
        }
        //將字串轉成物件
        record=JSON.parse(localStorage.getItem("record"));
        if(record){
            data=record
            //加入顯示紀錄動作
            let avg=(data.total/data.count).toFixed(1);
            document.querySelector("#record").innerHTML=`計入人數${data.count} 平均BMI${avg}`;
        }   
        console.log(data);

        function calc(){
            let height=heightEl.value;
            let weight=weightEl.value;

            if (height<=0 || weight<=0){
                alert("請輸入正確數值");
                return;
            }

            document.querySelector("#result").hidden=false;

            let sexEl=document.querySelector("input[name='sex']:checked");
            let userInfo=`姓名:${usernameEl.value} 年齡:${ageEl.value} 性別:${sexEl.value} 縣市:${countyEl.value}`;
            console.log(userInfo)
            document.querySelector("#info").innerHTML=`<h2>${userInfo}</h2>`

            let bmi=getBmi(height,weight);
            let comment=getComment(bmi)
            console.log(bmi);
            console.log(comment)

            const bmiEl=document.querySelector(".bmi");
            bmiEl.innerText=bmi;
            bmiEl.style.color=comment[1];

            const commentEl=document.querySelector(".comment");
            commentEl.innerText=comment[0];
            commentEl.style.color=comment[1];
            
            data["total"]+=Number(bmi);
            data.count+=1;

            console.log(data);
            
            let avg=(data.total/data.count).toFixed(1);
/*
            let recordEl=document.querySelector("#record");
            console.log(recordEl)
*/
            document.querySelector("#record").innerHTML=`計入人數${data.count} 平均BMI${avg}`;

            localStorage.setItem("record",JSON.stringify(data));
            localStorage.setItem("bmi",bmi);

            /*document.querySelector("#result").innerHTML="<h1>"+bmi+"</h1>";*/
            /*document.querySelector("#result").innerHTML=`<h1>BMI:${bmi}</h1><br><h1>${comment[0]}</h1>`;*/
        }

        function getBmi(height,weight){
            const bmi=weight/(height/100)**2;
               return bmi.toFixed(2);
        }

        function getComment(bmi){
            let comment,color
            if (bmi< 18.5){
                comment="「體重過輕」，需要多運動，均衡飲食，以增加體能，維持健康！";
                color="red"
            }
            else if (bmi< 24){
                comment="恭喜！「健康體重」，要繼續保持！";
                color="green"
            }
            else if (bmi< 27){
                comment="「體重過重」了，要小心囉，趕快力行「健康體重管理」！";
                color="orange"
            }
            else {
                comment="啊～「肥胖」，需要立刻力行「健康體重管理」囉！";
                color="red"
            }
            return [comment,color];

        }
    </script>

</body>

</html>







